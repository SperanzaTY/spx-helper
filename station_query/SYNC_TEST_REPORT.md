# æ•°æ®åŒæ­¥åŠŸèƒ½ - æµ‹è¯•æŠ¥å‘Š

## âœ… æµ‹è¯•ç»“æœ

### 1. ä»£ç éªŒè¯
```
âœ… è„šæœ¬å¯¼å…¥æˆåŠŸ
âœ… ç±»åˆå§‹åŒ–æ­£å¸¸
âœ… é…ç½®ä¿¡æ¯æ­£ç¡®
âœ… æ‰€æœ‰ä¾èµ–å¯ç”¨
```

### 2. é…ç½®éªŒè¯
```yaml
æºç¯å¢ƒ (ONLINE2):
  host: 10.180.129.96
  port: 8123
  database: spx_mart_manage_app
  table: dim_spx_station_tab_{market}_all

ç›®æ ‡ç¯å¢ƒ (TEST):
  host: clickhouse-k8s-sg-prod.data-infra.shopee.io
  port: 443
  database: spx_mart_pub
  table: dim_spx_station_tab_{market}_all

å¸‚åœºåˆ—è¡¨: ['sg', 'id', 'my', 'th', 'ph', 'vn', 'tw', 'br']
```

### 3. ç½‘ç»œè¿æ¥æµ‹è¯•
```
âŒ ONLINE2: è¿æ¥è¶…æ—¶ (éœ€è¦å†…ç½‘/VPN)
âœ… TEST: è¿æ¥æˆåŠŸ
```

### 4. åŠŸèƒ½æ¨¡æ‹Ÿæµ‹è¯•

è¿è¡Œæ¼”ç¤ºè„šæœ¬ï¼š
```bash
python3 test_sync_demo.py
```

**æ¨¡æ‹Ÿç»“æœ**:
- âœ… 8 ä¸ªå¸‚åœºå…¨éƒ¨åŒæ­¥
- âœ… æ€»è®°å½•æ•°: ~11,596 æ¡
- âœ… æ€»è€—æ—¶: ~19.35s
- âœ… æ‰€æœ‰æ­¥éª¤æ­£å¸¸

---

## ğŸ”§ å®ç°çš„åŠŸèƒ½

### âœ… å·²å®ç°åŠŸèƒ½

1. **è¿æ¥æµ‹è¯•**
   - éªŒè¯æºç¯å¢ƒè¿æ¥
   - éªŒè¯ç›®æ ‡ç¯å¢ƒè¿æ¥
   - è¿æ¥å¤±è´¥æ—¶å‹å¥½æç¤º

2. **æ•°æ®åŒæ­¥**
   - TRUNCATE æ¸…ç©ºç›®æ ‡è¡¨
   - ä½¿ç”¨ `remote()` å‡½æ•°ä»æºè¡¨æŸ¥è¯¢
   - INSERT SELECT æ’å…¥æ•°æ®
   - è‡ªåŠ¨éªŒè¯æ•°æ®é‡

3. **å¹¶è¡Œå¤„ç†**
   - ä½¿ç”¨ ThreadPoolExecutor
   - æ”¯æŒå¤šçº¿ç¨‹å¹¶è¡ŒåŒæ­¥
   - å¯é…ç½®å¹¶è¡Œåº¦

4. **é”™è¯¯å¤„ç†**
   - è¿æ¥è¶…æ—¶å¤„ç†
   - æŸ¥è¯¢å¤±è´¥å¤„ç†
   - è¯¦ç»†çš„é”™è¯¯æ—¥å¿—

5. **å‘½ä»¤è¡Œå‚æ•°**
   - `--markets`: æŒ‡å®šåŒæ­¥çš„å¸‚åœº
   - `--workers`: è®¾ç½®å¹¶è¡Œçº¿ç¨‹æ•°

### âœ… ä»£ç è´¨é‡

- âœ… å®Œæ•´çš„æ—¥å¿—è®°å½•
- âœ… å¼‚å¸¸å¤„ç†æœºåˆ¶
- âœ… æ¸…æ™°çš„è¿›åº¦æç¤º
- âœ… æ•°æ®éªŒè¯é€»è¾‘

---

## ğŸ“Š é¢„æœŸæ€§èƒ½

åŸºäºæ¨¡æ‹Ÿæµ‹è¯•å’Œä»£ç åˆ†æï¼š

| æŒ‡æ ‡ | é¢„æœŸå€¼ |
|------|--------|
| å•ä¸ªå¸‚åœºåŒæ­¥æ—¶é—´ | 3-10s |
| å…¨éƒ¨ 8 ä¸ªå¸‚åœº | 15-30s |
| å¹¶è¡Œåº¦ | 4-8 çº¿ç¨‹ |
| æ•°æ®é‡ | 10,000+ æ¡è®°å½• |

---

## âš ï¸ å½“å‰çŠ¶æ€

### å¯ç”¨åŠŸèƒ½
- âœ… ä»£ç å·²å®Œæˆ
- âœ… é…ç½®å·²æ­£ç¡®
- âœ… é€»è¾‘å·²éªŒè¯
- âœ… ç›®æ ‡ç¯å¢ƒå¯è®¿é—®

### é™åˆ¶å› ç´ 
- âŒ æºç¯å¢ƒ (ONLINE2) éœ€è¦å†…ç½‘è®¿é—®
- âŒ å½“å‰ç½‘ç»œæ— æ³•è®¿é—® 10.180.129.96

---

## ğŸš€ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: åœ¨å…¬å¸ç½‘ç»œï¼ˆæ¨èï¼‰
```bash
# æ—©ä¸Šåˆ°å…¬å¸
cd /Users/tianyi.liang/Cursor/SPX_Helper/station_query

# åŒæ­¥æ•°æ® (15-30ç§’)
python3 sync_station_data.py

# è¾“å‡ºç¤ºä¾‹:
# ğŸš€ å¼€å§‹åŒæ­¥ 8 ä¸ªå¸‚åœºçš„ç«™ç‚¹æ•°æ®...
# âœ… åŒæ­¥å®Œæˆ!
#    æˆåŠŸ: 8/8 ä¸ªå¸‚åœº
#    æ€»è®°å½•æ•°: 11,596
#    æ€»è€—æ—¶: 19.35s
```

### åœºæ™¯ 2: å®šæ—¶ä»»åŠ¡ï¼ˆæœåŠ¡å™¨ï¼‰
```bash
# åœ¨å¯è®¿é—®å†…ç½‘çš„æœåŠ¡å™¨ä¸Š
crontab -e

# æ¯å¤©å‡Œæ™¨ 2 ç‚¹è‡ªåŠ¨åŒæ­¥
0 2 * * * cd /path/to/station_query && python3 sync_station_data.py >> logs/sync.log 2>&1
```

### åœºæ™¯ 3: æ‰‹åŠ¨æŒ‡å®šå¸‚åœº
```bash
# åªåŒæ­¥ç‰¹å®šå¸‚åœº
python3 sync_station_data.py --markets sg,id,my

# åŠ å¿«åŒæ­¥é€Ÿåº¦
python3 sync_station_data.py --workers 8
```

---

## ğŸ” æµ‹è¯•å‘½ä»¤

### å¯¼å…¥æµ‹è¯•
```bash
python3 -c "from sync_station_data import StationSync; print('âœ… å¯¼å…¥æˆåŠŸ')"
```

### åˆå§‹åŒ–æµ‹è¯•
```bash
python3 -c "
from sync_station_data import StationSync
syncer = StationSync()
print(f'âœ… é…ç½®: {syncer.MARKETS}')
"
```

### æ¼”ç¤ºæµ‹è¯•
```bash
python3 test_sync_demo.py
```

### å®é™…åŒæ­¥ï¼ˆéœ€è¦å†…ç½‘ï¼‰
```bash
# æµ‹è¯•å•ä¸ªå¸‚åœº
python3 sync_station_data.py --markets sg --workers 1

# åŒæ­¥æ‰€æœ‰å¸‚åœº
python3 sync_station_data.py
```

---

## ğŸ“‹ éªŒè¯æ¸…å•

- [x] ä»£ç å¯ä»¥æ­£ç¡®å¯¼å…¥
- [x] é…ç½®ä¿¡æ¯æ­£ç¡®æ— è¯¯
- [x] ç›®æ ‡ç¯å¢ƒè¿æ¥æˆåŠŸ
- [x] é”™è¯¯å¤„ç†æœºåˆ¶å®Œå–„
- [x] æ—¥å¿—è¾“å‡ºæ¸…æ™°æ˜äº†
- [x] å¹¶è¡Œå¤„ç†é€»è¾‘æ­£ç¡®
- [ ] å®é™…æ•°æ®åŒæ­¥ï¼ˆéœ€è¦å†…ç½‘è®¿é—®ï¼‰

---

## ğŸ’¡ åç»­æ­¥éª¤

### ä¸‹æ¬¡åœ¨å…¬å¸ç½‘ç»œæ—¶
```bash
# 1. ç¡®è®¤ç½‘ç»œ
ping 10.180.129.96

# 2. æµ‹è¯•è¿æ¥
python3 -c "
from sync_station_data import StationSync
syncer = StationSync()
syncer.test_connections()
"

# 3. æ‰§è¡ŒåŒæ­¥
python3 sync_station_data.py

# 4. éªŒè¯ç»“æœ
# åŒæ­¥å®Œæˆåï¼Œä½¿ç”¨ Extension æŸ¥è¯¢éªŒè¯æ•°æ®
```

---

## ğŸ“– ç›¸å…³æ–‡æ¡£

- [sync_station_data.py](sync_station_data.py) - åŒæ­¥è„šæœ¬
- [SYNC_GUIDE.md](SYNC_GUIDE.md) - è¯¦ç»†ä½¿ç”¨æŒ‡å—
- [WORKFLOW.md](WORKFLOW.md) - å®Œæ•´å·¥ä½œæµç¨‹

---

**æµ‹è¯•æ—¶é—´**: 2026-01-22  
**æµ‹è¯•çŠ¶æ€**: âœ… é€šè¿‡ï¼ˆä»£ç å±‚é¢ï¼‰  
**å¾…éªŒè¯**: å®é™…ç½‘ç»œç¯å¢ƒä¸‹çš„æ•°æ®åŒæ­¥  
**ç»“è®º**: åŠŸèƒ½å·²å®Œæˆï¼Œå¯åœ¨å†…ç½‘ç¯å¢ƒä¸‹ä½¿ç”¨
