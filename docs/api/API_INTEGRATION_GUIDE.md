# Agent API æ¥å…¥æŒ‡å—

## ğŸ“‹ å½“å‰çŠ¶æ€

âœ… å‰ç«¯ç•Œé¢å·²å®Œæˆ
âœ… System Prompt å·²è®¾è®¡ï¼ˆè§ `AGENT_SYSTEM_PROMPT.md`ï¼‰
â³ ç­‰å¾… Agent API åœ°å€

---

## ğŸ”§ éœ€è¦æä¾›çš„ä¿¡æ¯

è¯·åœ¨ Smart å¹³å°åˆ›å»º Agent åï¼Œæä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

### å¿…éœ€ä¿¡æ¯
- **Agent API åœ°å€**ï¼ˆå®Œæ•´URLï¼‰

### API æ ¼å¼è¯´æ˜
è¯·å‘ŠçŸ¥ä»¥ä¸‹ä¿¡æ¯ï¼Œä»¥ä¾¿è°ƒæ•´ä»£ç ï¼š

1. **è¯·æ±‚æ ¼å¼**
   ```json
   {
     // æ¶ˆæ¯æ ¼å¼æ˜¯ä»€ä¹ˆï¼Ÿ
     // ä¾‹å¦‚ï¼š
     "messages": [...],
     // æˆ–è€…ï¼š
     "query": "...",
     // å…¶ä»–å¿…éœ€å­—æ®µï¼Ÿ
   }
   ```

2. **å“åº”æ ¼å¼**
   ```json
   {
     // å“åº”çš„æ¶ˆæ¯åœ¨å“ªä¸ªå­—æ®µï¼Ÿ
     // ä¾‹å¦‚ï¼š
     "response": "...",
     // æˆ–è€…ï¼š
     "message": "...",
     // æˆ–è€…ï¼š
     "content": "..."
   }
   ```

3. **æ˜¯å¦éœ€è¦è®¤è¯ï¼Ÿ**
   - å¦‚æœéœ€è¦ API Keyï¼Œè¯·å‘ŠçŸ¥åœ¨å“ªä¸ª header ä¸­ä¼ é€’
   - ä¾‹å¦‚ï¼š`Authorization: Bearer YOUR_KEY`

---

## ğŸ’» å½“å‰ä»£ç ä½ç½®

éœ€è¦è°ƒæ•´çš„ä»£ç åœ¨ `popup.js` çš„ `sendMessage` å‡½æ•°ä¸­ï¼š

```javascript
// 605-609è¡Œï¼šå‡†å¤‡è¯·æ±‚æ•°æ®
const requestData = {
  messages: chatHistory,
  // è¿™é‡Œçš„æ ¼å¼ç­‰ä½ æä¾›APIæ–‡æ¡£åå†è°ƒæ•´
};

// 612-618è¡Œï¼šè°ƒç”¨API
const response = await fetch(config.apiUrl, {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
    // å¦‚æœéœ€è¦è®¤è¯ï¼Œåœ¨è¿™é‡Œæ·»åŠ 
  },
  body: JSON.stringify(requestData)
});

// 626-627è¡Œï¼šè§£æå“åº”
const assistantMessage = data.response || data.message || data.content;
```

---

## ğŸ“ è°ƒæ•´ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šOpenAI é£æ ¼ API

**å¦‚æœ API æ ¼å¼ç±»ä¼¼ OpenAIï¼š**

```javascript
// è¯·æ±‚
const requestData = {
  messages: chatHistory,  // [{ role: 'user', content: '...' }, ...]
  model: 'your-model-name'
};

// å“åº”
const data = await response.json();
const assistantMessage = data.choices[0].message.content;
```

### ç¤ºä¾‹ 2ï¼šç®€å•å¯¹è¯ API

**å¦‚æœ API åªæ¥å—å•ä¸ªæŸ¥è¯¢ï¼š**

```javascript
// è¯·æ±‚
const requestData = {
  query: chatHistory[chatHistory.length - 1].content,
  session_id: 'unique-session-id'
};

// å“åº”
const data = await response.json();
const assistantMessage = data.answer;
```

### ç¤ºä¾‹ 3ï¼šéœ€è¦è®¤è¯çš„ API

**å¦‚æœéœ€è¦ API Keyï¼š**

```javascript
// é…ç½®ä¸­ä¿å­˜ apiKey
const config = {
  apiUrl: '...',
  apiKey: '...'
};

// è¯·æ±‚æ—¶æ·»åŠ è®¤è¯å¤´
headers: {
  'Content-Type': 'application/json',
  'Authorization': `Bearer ${config.apiKey}`
}
```

---

## ğŸš€ æ¥å…¥æµç¨‹

1. **åœ¨ Smart å¹³å°åˆ›å»º Agent**
   - å¤åˆ¶ `AGENT_SYSTEM_PROMPT.md` ä¸­çš„å†…å®¹ä½œä¸º System Prompt
   - é…ç½® Agent çš„å…¶ä»–å‚æ•°

2. **è·å– API ä¿¡æ¯**
   - API åœ°å€
   - è¯·æ±‚/å“åº”æ ¼å¼
   - è®¤è¯æ–¹å¼ï¼ˆå¦‚éœ€è¦ï¼‰

3. **æä¾›ç»™æˆ‘**
   - æˆ‘ä¼šæ ¹æ®å®é™… API æ ¼å¼è°ƒæ•´ä»£ç 

4. **é…ç½®æ‰©å±•**
   - åœ¨æ‰©å±•çš„ "SQLåŠ©æ‰‹" æ ‡ç­¾é¡µ
   - å±•å¼€ "âš™ï¸ Agent APIé…ç½®"
   - å¡«å…¥ Agent API åœ°å€
   - ç‚¹å‡»ä¿å­˜

5. **å¼€å§‹ä½¿ç”¨**
   - åœ¨å¯¹è¯æ¡†ä¸­è¾“å…¥ SQL é—®é¢˜
   - Agent ä¼šè‡ªåŠ¨å¼•å¯¼å’Œå›ç­”

---

## ğŸ¯ åŠŸèƒ½ç‰¹ç‚¹

### å¯¹è¯å¼äº¤äº’
- æ”¯æŒå¤šè½®å¯¹è¯
- è‡ªåŠ¨ä¿å­˜å¯¹è¯å†å²
- å¯éšæ—¶æ¸…ç©ºå¯¹è¯

### å¼•å¯¼å¼æé—®
Agent ä¼šå¼•å¯¼ç”¨æˆ·ï¼š
1. è¯´æ˜æ˜¯åˆ›å»º SQL è¿˜æ˜¯ä¿®å¤ SQL
2. é€‰æ‹© SQL æ–¹è¨€ï¼ˆPresto/Spark/ClickHouseï¼‰
3. æä¾›å¿…è¦çš„ä¸Šä¸‹æ–‡ä¿¡æ¯
4. å¯¹äºä¿®å¤ï¼Œè¦æ±‚æä¾›å®Œæ•´æŠ¥é”™ä¿¡æ¯

### æ™ºèƒ½ä¿®å¤
- åˆ†ææŠ¥é”™åŸå› 
- è¯†åˆ« SQL æ–¹è¨€å·®å¼‚
- æä¾›ä¿®æ­£åçš„å®Œæ•´ SQL
- è§£é‡Šä¿®æ”¹åŸå› å’Œæ³¨æ„äº‹é¡¹

---

## ğŸ” æµ‹è¯•æ£€æŸ¥æ¸…å•

API æ¥å…¥åéœ€è¦æµ‹è¯•ï¼š

- [ ] å‘é€ç¬¬ä¸€æ¡æ¶ˆæ¯ï¼ŒAgent æ­£ç¡®å“åº”
- [ ] Agent ä¼šå¼•å¯¼è¯¢é—® SQL æ–¹è¨€
- [ ] æä¾› SQL åˆ›å»ºåœºæ™¯ï¼ŒAgent èƒ½æ­£ç¡®ç¼–å†™ SQL
- [ ] æä¾› SQL ä¿®å¤åœºæ™¯ï¼ˆå¸¦æŠ¥é”™ï¼‰ï¼ŒAgent èƒ½å‡†ç¡®ä¿®æ­£
- [ ] å¤šè½®å¯¹è¯èƒ½æ­£å¸¸è¿›è¡Œ
- [ ] å¯¹è¯å†å²èƒ½æ­£ç¡®ä¿å­˜å’Œæ˜¾ç¤º
- [ ] æ¸…ç©ºå¯¹è¯åŠŸèƒ½æ­£å¸¸
- [ ] é”™è¯¯å¤„ç†ï¼šAPI åœ°å€é”™è¯¯æ—¶æ˜¾ç¤ºå‹å¥½æç¤º
- [ ] é”™è¯¯å¤„ç†ï¼šç½‘ç»œå¼‚å¸¸æ—¶æ˜¾ç¤ºå‹å¥½æç¤º

---

## ğŸ“ ä¸‹ä¸€æ­¥

ç­‰ä½ åˆ›å»ºå¥½ Agent å¹¶è·å– API ä¿¡æ¯åï¼Œè¯·æä¾›ï¼š

1. **Agent API å®Œæ•´åœ°å€**
2. **API è¯·æ±‚ç¤ºä¾‹**ï¼ˆcurl æˆ– JSON æ ¼å¼ï¼‰
3. **API å“åº”ç¤ºä¾‹**ï¼ˆJSON æ ¼å¼ï¼‰
4. **è®¤è¯æ–¹å¼**ï¼ˆå¦‚æœéœ€è¦ï¼‰

æˆ‘ä¼šç«‹å³è°ƒæ•´ä»£ç å®Œæˆæ¥å…¥ï¼ğŸš€

