# API 溯源工具设置功能 - 测试清单

## 测试环境准备
1. 重新加载扩展：`chrome://extensions/` → 刷新 SPX Helper
2. 打开测试页面：任意 FMS 页面（如 https://spx.shopee.co.id/）
3. 打开浏览器控制台（F12）

---

## 测试 1: 文本选取开关 - 默认开启

### 步骤
1. 刷新页面（Cmd+Shift+R）
2. 在页面上选择任意文字（如订单号、金额）
3. 观察是否显示浮动按钮

### 预期结果
✅ 显示 "🔍 查找来源" 浮动按钮  
✅ 控制台日志：`✅ [SPX Helper] 初始化文本选取监听器`

---

## 测试 2: 关闭文本选取功能

### 步骤
1. 打开扩展弹窗
2. 进入 **🔧 实用工具** → **App 工具** → **🔍 API 数据溯源**
3. 在 **⚙️ 功能设置** 区域，点击 "文本选取查找" 开关关闭
4. 回到页面，选择文字

### 预期结果
✅ Toast 提示：`⏸️ 文本选取功能已关闭`  
✅ 选择文字不显示浮动按钮  
✅ 控制台日志：`🔄 [SPX Helper] 文本选取功能状态已更新: false`  
✅ 控制台日志：`⏸️ [SPX Helper] 文本选取功能已禁用`

---

## 测试 3: 重新开启文本选取功能

### 步骤
1. 打开扩展弹窗
2. 点击开关重新开启
3. 回到页面，选择文字

### 预期结果
✅ Toast 提示：`✅ 文本选取功能已开启`  
✅ 显示浮动按钮  
✅ 控制台日志：`🔄 [SPX Helper] 文本选取功能状态已更新: true`

---

## 测试 4: API 过滤条件 - 默认配置

### 步骤
1. 刷新页面
2. 观察控制台，查看拦截的接口

### 预期结果
✅ 控制台日志：`⚙️ [SPX Helper] API 过滤条件已更新: ["api_mart"]`  
✅ 只拦截包含 `api_mart` 的接口  
✅ 其他接口显示：`⏭️ [SPX Helper] 跳过接口（不匹配过滤条件）`

---

## 测试 5: 修改过滤条件 - 拦截所有接口

### 步骤
1. 打开扩展弹窗
2. 在 "API 过滤条件" 输入框中**清空内容**
3. 点击 "💾 保存过滤条件"
4. 点击 "🔄 刷新页面" 按钮
5. 观察控制台

### 预期结果
✅ Toast 提示：`✅ 过滤条件已保存，刷新页面后生效`  
✅ 显示提示：`⚠️ 请刷新页面让新的过滤条件生效`  
✅ 刷新后，控制台日志：`⚙️ [SPX Helper] API 过滤条件已更新: 拦截所有接口`  
✅ 拦截所有 HTTP 请求（包括 config, autobahn 等）  
✅ "已捕获 API 请求" 数量大幅增加

---

## 测试 6: 修改过滤条件 - 多个关键词

### 步骤
1. 在过滤条件输入框中填写：`api_mart, /api/bff/, graphql`
2. 点击保存并刷新页面
3. 观察控制台

### 预期结果
✅ 控制台日志：`⚙️ [SPX Helper] API 过滤条件已更新: ["api_mart", "/api/bff/", "graphql"]`  
✅ 只拦截 URL 包含这三个关键词的接口  
✅ 其他接口被跳过

---

## 测试 7: 恢复默认配置

### 步骤
1. 在过滤条件输入框中填写：`api_mart`
2. 点击保存并刷新页面

### 预期结果
✅ 恢复到默认行为，只拦截 api_mart 接口

---

## 测试 8: 状态持久化

### 步骤
1. 关闭文本选取功能
2. 修改 API 过滤条件为 `/api/`
3. 关闭扩展弹窗
4. 重新打开扩展弹窗

### 预期结果
✅ 文本选取开关保持关闭状态  
✅ API 过滤条件输入框显示 `/api/`  
✅ 刷新页面后新配置生效

---

## 测试 9: 多标签页同步

### 步骤
1. 打开两个 FMS 页面标签
2. 在扩展弹窗中关闭文本选取功能
3. 在两个标签页中尝试选择文字

### 预期结果
✅ 两个标签页都不显示浮动按钮  
✅ 两个标签页的控制台都显示：`🔄 [SPX Helper] 文本选取功能状态已更新: false`

---

## 测试 10: 边界情况 - 特殊字符

### 步骤
1. 在过滤条件中填写：`api_mart, /api/v2/, order?status=`
2. 保存并刷新
3. 查看是否正确拦截

### 预期结果
✅ 正确解析包含 `/`, `?`, `=` 的关键词  
✅ 匹配包含这些字符串的 URL

---

## 性能测试

### 场景 1: 高性能配置
**配置：** `api_mart`  
**预期：** 拦截 5-10 个接口，页面流畅

### 场景 2: 全量配置
**配置：** 留空  
**预期：** 拦截 50+ 个接口，可能有轻微卡顿

---

## 常见问题排查

### 问题 1: 修改过滤条件后没生效
**原因：** 未刷新页面  
**解决：** 点击 "🔄 刷新页面" 按钮

### 问题 2: 开关切换后没反应
**原因：** Content script 未加载  
**解决：** 刷新页面让 content.js 重新加载

### 问题 3: 控制台没有日志
**原因：** 扩展未正确加载  
**解决：** 重新加载扩展

---

## 测试结果记录

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 测试 1 | ⬜ |  |
| 测试 2 | ⬜ |  |
| 测试 3 | ⬜ |  |
| 测试 4 | ⬜ |  |
| 测试 5 | ⬜ |  |
| 测试 6 | ⬜ |  |
| 测试 7 | ⬜ |  |
| 测试 8 | ⬜ |  |
| 测试 9 | ⬜ |  |
| 测试 10 | ⬜ |  |

---

## 版本信息
- **功能版本：** v2.13.0
- **测试日期：** _________
- **测试人员：** _________
