# 🧪 API 溯源工具 - 快速测试指南

## 📋 测试前准备

1. **重新加载扩展**
   ```
   1. 打开 chrome://extensions/
   2. 找到 SPX Helper
   3. 点击"重新加载"按钮 🔄
   ```

2. **打开测试页面**
   - 推荐使用有 API 调用的页面（如 DataSuite、FMS 等）
   - 或使用任意有动态数据的网站

---

## ✅ 测试步骤

### 第1步：验证 API 拦截
```
1. 打开测试页面（如 DataSuite）
2. 打开浏览器开发者工具（F12）
3. 切换到 Console 标签
4. 刷新页面
5. 应该看到类似的日志：
   ✅ [SPX Helper] API 数据溯源工具已加载
   ✅ [SPX Helper] 开始拦截 API 请求
   📡 [SPX Helper] Fetch: https://...
   📡 [SPX Helper] XHR: https://...
```

### 第2步：打开扩展
```
1. 点击浏览器右上角的 SPX Helper 图标
2. 切换到"实用工具"标签
3. 点击"API溯源"按钮
4. 应该看到：
   - "已捕获 API" 数量 > 0
   - "最近的 API 调用"列表显示最近的请求
```

### 第3步：启动检查器
```
1. 点击"🎯 启动检查器"按钮
2. 扩展窗口会自动关闭
3. 页面顶部应该出现紫色提示条：
   "🎯 API 溯源模式 - 点击元素查看数据来源"
```

### 第4步：测试元素高亮
```
1. 移动鼠标到页面上的元素
2. 元素应该被紫色边框高亮
3. 元素上方应该显示标签信息（如 "div.card"）
```

### 第5步：点击元素追踪
```
1. 点击一个包含数据的元素（如表格行、卡片等）
2. 应该弹出数据来源面板
3. 面板应该显示：
   - API 方法（GET/POST）
   - API URL
   - 状态码（200）
   - 匹配数量
   - 匹配详情
```

### 第6步：查看详细信息
```
1. 在数据来源面板中，点击"📋 查看匹配详情"
2. 应该展开显示匹配的字段路径
3. 点击"📄 查看完整响应"
4. 应该在新窗口打开完整的 JSON 响应
```

### 第7步：测试复制功能
```
1. 点击"📋 复制 URL"按钮
2. 应该显示"✅ URL 已复制到剪贴板"提示
3. 粘贴到记事本，验证 URL 正确
```

### 第8步：退出检查器
```
1. 按 ESC 键
2. 顶部提示条消失
3. 鼠标移动不再高亮元素
4. 检查器模式已退出
```

### 第9步：测试"未找到"情况
```
1. 重新启动检查器
2. 点击一个硬编码的元素（如标题、按钮等）
3. 应该显示"未找到数据来源"面板
4. 提示可能原因
```

---

## ✅ 功能检查清单

- [ ] API 自动拦截（Console 有日志）
- [ ] API 数量统计正确
- [ ] 最近 API 列表显示正常
- [ ] 启动检查器按钮工作
- [ ] 页面顶部提示条显示
- [ ] 元素高亮效果正常
- [ ] 元素标签信息显示
- [ ] 点击元素弹出面板
- [ ] 数据来源匹配正确
- [ ] 匹配详情展开正常
- [ ] 查看完整响应功能
- [ ] 复制 URL 功能
- [ ] ESC 键退出正常
- [ ] 未找到数据提示正常

---

## 🐛 常见问题

### 问题1：扩展无法注入 content.js
**症状**: Console 中没有 "[SPX Helper] API 数据溯源工具已加载" 日志

**解决方案**:
1. 确认 manifest.json 已更新
2. 确认 content.js 文件存在
3. 重新加载扩展
4. 刷新测试页面

### 问题2：启动检查器失败
**症状**: 点击"启动检查器"提示"无法启动检查器"

**解决方案**:
1. 刷新测试页面
2. 重新打开扩展
3. 再次点击"启动检查器"

### 问题3：API 数量为 0
**症状**: "已捕获 API" 显示 0

**解决方案**:
1. 确认页面有 API 调用
2. 刷新页面让 content.js 重新注入
3. 检查 Console 是否有拦截日志

### 问题4：点击元素没有反应
**症状**: 点击元素后没有弹出面板

**可能原因**:
1. 元素内容是硬编码的（非 API 数据）
2. API 响应尚未被拦截
3. 文本匹配失败（文本太长或格式不匹配）

**解决方案**:
1. 尝试点击其他有明显数据的元素
2. 等待页面完全加载后再启动检查器
3. 查看"未找到数据来源"提示

---

## 📊 测试数据

### 推荐测试页面
1. **DataSuite**: 表格数据丰富
2. **FMS SPX Admin**: 站点信息
3. **任意带有数据列表的页面**

### 预期结果
- API 拦截率: 100%
- 数据匹配准确率: > 90%
- 响应时间: < 100ms
- 内存占用: < 10MB

---

## 🎯 快速测试命令

在浏览器 Console 中运行：

```javascript
// 检查 content.js 是否加载
console.log('API Tracker:', window.spxAPITracker ? '✅ 已加载' : '❌ 未加载');

// 查看已捕获的 API 数量
console.log('API 数量:', window.spxAPITracker?.apiRecords.size || 0);

// 查看检查器状态
console.log('检查器:', window.spxAPITracker?.inspectorMode ? '运行中' : '未启动');

// 手动启动检查器
window.spxAPITracker?.enableInspectorMode();

// 手动停止检查器
window.spxAPITracker?.disableInspectorMode();
```

---

## ✅ 测试完成标准

所有以下条件满足即为测试通过：

1. ✅ API 自动拦截正常
2. ✅ 检查器启动成功
3. ✅ 元素高亮显示正常
4. ✅ 数据来源匹配正确
5. ✅ 面板交互功能正常
6. ✅ 退出检查器正常
7. ✅ 无控制台错误

---

## 🚀 下一步

测试通过后：
1. 提交代码到 Git
2. 创建 v2.9.0 release
3. 更新文档
4. 通知团队使用

Happy Testing! 🎉
